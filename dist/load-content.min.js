!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";class LoadContent extends HTMLElement{constructor(){super(),this.currentPage=1,this.hasNextPage=!1,this.baseUrl="",this.mode="append",this.contentSelectors=[],this.appendFilter="",this.itemsShown=0,this.isLoading=!1,this.handleClick=this.handleClick.bind(this)}connectedCallback(){this.readAttributes(),this.addEventListener("click",this.handleClick),this.updateButtonState()}disconnectedCallback(){this.removeEventListener("click",this.handleClick)}readAttributes(){this.currentPage=Number(this.dataset.currentPage)||1,this.hasNextPage="true"===this.dataset.hasNextPage,this.baseUrl=this.dataset.url||window.location.pathname,this.mode=this.dataset.mode||"append",this.contentSelectors=(this.dataset.targets||"").split(",").map((t=>t.trim())).filter(Boolean),this.appendFilter=this.dataset.appendFilter||"",this.itemsShown=this.contentSelectors.reduce(((t,e)=>{const s=document.querySelector(e);return s?t+s.children.length:t}),0)}reset(t={}){void 0!==t.currentPage&&(this.dataset.currentPage=String(t.currentPage)),void 0!==t.hasNextPage&&(this.dataset.hasNextPage=String(t.hasNextPage)),void 0!==t.url&&(this.dataset.url=t.url),void 0!==t.targets&&(this.dataset.targets=Array.isArray(t.targets)?t.targets.join(", "):String(t.targets)),void 0!==t.mode&&(this.dataset.mode=t.mode),void 0!==t.appendFilter&&(this.dataset.appendFilter=t.appendFilter),this.readAttributes(),this.updateButtonState(),this.dispatchEvent(new CustomEvent("onReset",{bubbles:!0,detail:{currentPage:this.currentPage,hasNextPage:this.hasNextPage,itemsShown:this.itemsShown}}))}disable(){this.setAttribute("disabled",""),this.setAttribute("data-state","loading")}enable(){this.removeAttribute("disabled"),this.setAttribute("data-state","ready")}setComplete(){this.setAttribute("disabled",""),this.setAttribute("data-state","complete")}updateButtonState(){this.isLoading?this.disable():this.hasNextPage?this.enable():this.setComplete()}async handleClick(t){if(t.preventDefault(),this.hasNextPage&&!this.isLoading){this.isLoading=!0,this.updateButtonState();try{await this.fetchAndAppendNextPage()}catch(t){console.error("load-content: failed to load next page",t)}finally{this.isLoading=!1,this.updateButtonState()}}}buildNextPageUrl(){const t=new URL(this.baseUrl,window.location.origin);return"append"===this.mode&&void 0!==this.dataset.currentPage&&t.searchParams.set("page",String(this.currentPage+1)),t.href}async fetchAndAppendNextPage(){const t=await fetch(this.buildNextPageUrl(),{credentials:"same-origin"});if(!t.ok)throw new Error(`http error ${t.status}`);const e=await t.text(),s=(new DOMParser).parseFromString(e,"text/html");this.contentSelectors.forEach((t=>{const e=s.querySelector(t),a=document.querySelector(t);if(!e||!a)return void console.warn(`load-content: selector "${t}" not found in one of the documents`);const i=a.getAttribute("data-load-content");if("swap"===i||null===i&&"swap"===this.mode)a.innerHTML=e.innerHTML,this.itemsShown=a.children.length;else{let t=Array.from(e.children);this.appendFilter&&(t=t.filter((t=>t.matches(this.appendFilter)))),t.forEach((t=>{a.appendChild(t),this.itemsShown+=1}))}})),this.currentPage+=1;const a=s.querySelector("load-content");a&&void 0!==a.dataset.hasNextPage&&(this.hasNextPage="true"===a.dataset.hasNextPage),this.dataset.currentPage=String(this.currentPage),this.dataset.hasNextPage=String(this.hasNextPage),this.updateButtonState(),this.dispatchEvent(new CustomEvent("onContentLoaded",{bubbles:!0,detail:{document:s,itemsShown:this.itemsShown,currentPage:this.currentPage}}))}}customElements.get("load-content")||customElements.define("load-content",LoadContent)}));
