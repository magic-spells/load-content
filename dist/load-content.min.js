!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";class LoadContent extends HTMLElement{constructor(){super(),this.currentPage=1,this.hasNextPage=!1,this.baseUrl="",this.mode="append",this.contentSelectors=[],this.appendFilter="",this.itemsShown=0,this.isLoading=!1,this.handleClick=this.handleClick.bind(this)}connectedCallback(){this.readAttributes(),this.addEventListener("click",this.handleClick),this.updateButtonState()}disconnectedCallback(){this.removeEventListener("click",this.handleClick)}readAttributes(){const t=this;t.currentPage=Number(t.getAttribute("current-page"))||1,t.hasNextPage="true"===t.getAttribute("has-next-page"),t.baseUrl=t.getAttribute("url")||window.location.pathname,t.mode=t.getAttribute("mode")||"append",t.contentSelectors=(t.getAttribute("targets")||"").split(",").map((t=>t.trim())).filter(Boolean),t.appendFilter=t.getAttribute("append-filter")||"",t.itemsShown=t.contentSelectors.reduce(((t,e)=>{const n=document.querySelector(e);return n?t+n.children.length:t}),0)}reset(t={}){const e=this;void 0!==t.currentPage&&e.setAttribute("current-page",String(t.currentPage)),void 0!==t.hasNextPage&&e.setAttribute("has-next-page",String(t.hasNextPage)),void 0!==t.url&&e.setAttribute("url",t.url),void 0!==t.targets&&e.setAttribute("targets",Array.isArray(t.targets)?t.targets.join(", "):String(t.targets)),void 0!==t.mode&&e.setAttribute("mode",t.mode),void 0!==t.appendFilter&&e.setAttribute("append-filter",t.appendFilter),e.readAttributes(),e.updateButtonState(),e.dispatchEvent(new CustomEvent("onReset",{bubbles:!0,detail:{currentPage:e.currentPage,hasNextPage:e.hasNextPage,itemsShown:e.itemsShown}}))}disable(){this.setAttribute("disabled",""),this.setAttribute("data-state","loading")}enable(){this.removeAttribute("disabled"),this.setAttribute("data-state","ready")}setComplete(){this.setAttribute("disabled",""),this.setAttribute("data-state","complete")}updateButtonState(){this.isLoading?this.disable():this.hasNextPage?this.enable():this.setComplete()}async handleClick(t){const e=this;if(t.preventDefault(),e.hasNextPage&&!e.isLoading){e.isLoading=!0,e.updateButtonState();try{await e.fetchAndAppendNextPage()}catch(t){console.error("load-content: failed to load next page",t)}finally{e.isLoading=!1,e.updateButtonState()}}}buildNextPageUrl(){const t=this,e=new URL(t.baseUrl,window.location.origin);return"append"===t.mode&&null!==t.getAttribute("current-page")&&e.searchParams.set("page",String(t.currentPage+1)),e.href}async fetchAndAppendNextPage(){const t=this,e=await fetch(t.buildNextPageUrl(),{credentials:"same-origin"});if(!e.ok)throw new Error(`http error ${e.status}`);const n=await e.text(),a=(new DOMParser).parseFromString(n,"text/html");t.contentSelectors.forEach((e=>{const n=a.querySelector(e),r=document.querySelector(e);if(!n||!r)return void console.warn(`load-content: selector "${e}" not found in one of the documents`);const i=r.getAttribute("data-load-content");if("swap"===i||null===i&&"swap"===t.mode)r.innerHTML=n.innerHTML,t.itemsShown=r.children.length;else{let e=Array.from(n.children);t.appendFilter&&(e=e.filter((e=>e.matches(t.appendFilter)))),e.forEach((e=>{r.appendChild(e),t.itemsShown+=1}))}})),t.currentPage+=1;const r=a.querySelector("load-content");r&&null!==r.getAttribute("has-next-page")&&(t.hasNextPage="true"===r.getAttribute("has-next-page")),t.setAttribute("current-page",String(t.currentPage)),t.setAttribute("has-next-page",String(t.hasNextPage)),t.updateButtonState(),t.dispatchEvent(new CustomEvent("onContentLoaded",{bubbles:!0,detail:{document:a,itemsShown:t.itemsShown,currentPage:t.currentPage}}))}}customElements.get("load-content")||customElements.define("load-content",LoadContent)}));
//# sourceMappingURL=load-content.min.js.map
