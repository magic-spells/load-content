{"version":3,"file":"load-content.min.js","sources":["../src/load-content.js"],"sourcesContent":["import \"./load-content.scss\";\n\n/* ------------------------------------------------------------------\n * <load-content> web component\n * ---------------------------------------------------------------- */\nclass LoadContent extends HTMLElement {\n\t/** sets up internal state and binds methods */\n\tconstructor() {\n\t\tsuper();\n\n\t\t/** @private {number} current page index (1-based) */\n\t\tthis.currentPage = 1;\n\n\t\t/** @private {boolean} whether another page exists */\n\t\tthis.hasNextPage = false;\n\n\t\t/** @private {string} base url to request more html from */\n\t\tthis.baseUrl = \"\";\n\n\t\t/** @private {string} default mode for content loading (append|swap) */\n\t\tthis.mode = \"append\";\n\n\t\t/** @private {string[]} css selectors whose children weâ€™ll append */\n\t\tthis.contentSelectors = [];\n\n\t\t/** @private {string} css selector to filter which children to append */\n\t\tthis.appendFilter = \"\";\n\n\t\t/** @private {number} total items that have been appended so far */\n\t\tthis.itemsShown = 0;\n\n\t\t/** @private {boolean} guard to prevent duplicate clicks while loading */\n\t\tthis.isLoading = false;\n\n\t\t/* bind so we can remove listener if element detaches */\n\t\tthis.handleClick = this.handleClick.bind(this);\n\t}\n\n\t/* --------------------------------------------------------------\n\t * lifecycle\n\t * ---------------------------------------------------------- */\n\tconnectedCallback() {\n\t\tthis.readAttributes();\n\t\tthis.addEventListener(\"click\", this.handleClick);\n\t\tthis.updateButtonState();\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.removeEventListener(\"click\", this.handleClick);\n\t}\n\n\t/* --------------------------------------------------------------\n\t * attribute helpers\n\t * ---------------------------------------------------------- */\n\t/** parses data- attributes into internal state */\n\treadAttributes() {\n\t\tthis.currentPage = Number(this.dataset.currentPage) || 1;\n\t\tthis.hasNextPage = this.dataset.hasNextPage === \"true\";\n\t\tthis.baseUrl = this.dataset.url || window.location.pathname;\n\t\tthis.mode = this.dataset.mode || \"append\";\n\t\tthis.contentSelectors = (this.dataset.targets || \"\")\n\t\t\t.split(\",\")\n\t\t\t.map((s) => s.trim())\n\t\t\t.filter(Boolean);\n\t\tthis.appendFilter = this.dataset.appendFilter || \"\";\n\n\t\t/* recount items currently in the dom */\n\t\tthis.itemsShown = this.contentSelectors.reduce((sum, selector) => {\n\t\t\tconst el = document.querySelector(selector);\n\t\t\treturn el ? sum + el.children.length : sum;\n\t\t}, 0);\n\t}\n\n\t/* --------------------------------------------------------------\n\t * public api\n\t * ---------------------------------------------------------- */\n\t/**\n\t * resets internal + reflected state\n\t * @param {Object} opts\n\t */\n\treset(opts = {}) {\n\t\tif (opts.currentPage !== undefined)\n\t\t\tthis.dataset.currentPage = String(opts.currentPage);\n\t\tif (opts.hasNextPage !== undefined)\n\t\t\tthis.dataset.hasNextPage = String(opts.hasNextPage);\n\t\tif (opts.url !== undefined) this.dataset.url = opts.url;\n\t\tif (opts.targets !== undefined) {\n\t\t\tthis.dataset.targets = Array.isArray(opts.targets)\n\t\t\t\t? opts.targets.join(\", \")\n\t\t\t\t: String(opts.targets);\n\t\t}\n\t\tif (opts.mode !== undefined) this.dataset.mode = opts.mode;\n\t\tif (opts.appendFilter !== undefined)\n\t\t\tthis.dataset.appendFilter = opts.appendFilter;\n\n\t\tthis.readAttributes();\n\t\tthis.updateButtonState();\n\n\t\tthis.dispatchEvent(\n\t\t\tnew CustomEvent(\"onReset\", {\n\t\t\t\tbubbles: true,\n\t\t\t\tdetail: {\n\t\t\t\t\tcurrentPage: this.currentPage,\n\t\t\t\t\thasNextPage: this.hasNextPage,\n\t\t\t\t\titemsShown: this.itemsShown,\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\t/* --------------------------------------------------------------\n\t * button state helpers\n\t * ---------------------------------------------------------- */\n\tdisable() {\n\t\tthis.setAttribute(\"disabled\", \"\");\n\t\tthis.setAttribute(\"data-state\", \"loading\");\n\t}\n\n\tenable() {\n\t\tthis.removeAttribute(\"disabled\");\n\t\tthis.setAttribute(\"data-state\", \"ready\");\n\t}\n\n\tsetComplete() {\n\t\tthis.setAttribute(\"disabled\", \"\");\n\t\tthis.setAttribute(\"data-state\", \"complete\");\n\t}\n\n\tupdateButtonState() {\n\t\tif (this.isLoading) this.disable();\n\t\telse if (!this.hasNextPage) this.setComplete();\n\t\telse this.enable();\n\t}\n\n\t/* --------------------------------------------------------------\n\t * click + fetch\n\t * ---------------------------------------------------------- */\n\tasync handleClick(evt) {\n\t\tevt.preventDefault();\n\t\tif (!this.hasNextPage || this.isLoading) return;\n\n\t\tthis.isLoading = true;\n\t\tthis.updateButtonState();\n\n\t\ttry {\n\t\t\tawait this.fetchAndAppendNextPage();\n\t\t} catch (err) {\n\t\t\tconsole.error(\"load-content: failed to load next page\", err);\n\t\t} finally {\n\t\t\tthis.isLoading = false;\n\t\t\tthis.updateButtonState();\n\t\t}\n\t}\n\n\t/** builds ?page= param for the next request */\n\tbuildNextPageUrl() {\n\t\tconst url = new URL(this.baseUrl, window.location.origin);\n\t\tif (this.mode === \"append\" && this.dataset.currentPage !== undefined) {\n\t\t\turl.searchParams.set(\"page\", String(this.currentPage + 1));\n\t\t}\n\t\treturn url.href;\n\t}\n\n\t/** fetches next page, injects html, updates state */\n\tasync fetchAndAppendNextPage() {\n\t\tconst response = await fetch(this.buildNextPageUrl(), {\n\t\t\tcredentials: \"same-origin\",\n\t\t});\n\t\tif (!response.ok) throw new Error(`http error ${response.status}`);\n\n\t\tconst html = await response.text();\n\t\tconst parsedDoc = new DOMParser().parseFromString(html, \"text/html\");\n\n\t\tthis.contentSelectors.forEach((selector) => {\n\t\t\tconst sourceEl = parsedDoc.querySelector(selector);\n\t\t\tconst destinationEl = document.querySelector(selector);\n\n\t\t\tif (!sourceEl || !destinationEl) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`load-content: selector \"${selector}\" not found in one of the documents`,\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst elementMode = destinationEl.getAttribute(\"data-load-content\");\n\t\t\tconst shouldSwap =\n\t\t\t\telementMode === \"swap\" ||\n\t\t\t\t(elementMode === null && this.mode === \"swap\");\n\n\t\t\tif (shouldSwap) {\n\t\t\t\t// swap entire content\n\t\t\t\tdestinationEl.innerHTML = sourceEl.innerHTML;\n\t\t\t\tthis.itemsShown = destinationEl.children.length; // keep count accurate\n\t\t\t} else {\n\t\t\t\t// gather children and optionally filter\n\t\t\t\tlet childrenToAppend = Array.from(sourceEl.children);\n\t\t\t\tif (this.appendFilter) {\n\t\t\t\t\tchildrenToAppend = childrenToAppend.filter((child) =>\n\t\t\t\t\t\tchild.matches(this.appendFilter),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tchildrenToAppend.forEach((child) => {\n\t\t\t\t\tdestinationEl.appendChild(child);\n\t\t\t\t\tthis.itemsShown += 1;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t/* update page counter */\n\t\tthis.currentPage += 1;\n\n\t\t/* read has-next-page flag from fetched markup */\n\t\tconst newLoadContentEl = parsedDoc.querySelector(\"load-content\");\n\t\tif (\n\t\t\tnewLoadContentEl &&\n\t\t\tnewLoadContentEl.dataset.hasNextPage !== undefined\n\t\t) {\n\t\t\tthis.hasNextPage = newLoadContentEl.dataset.hasNextPage === \"true\";\n\t\t}\n\n\t\t/* reflect new values outward */\n\t\tthis.dataset.currentPage = String(this.currentPage);\n\t\tthis.dataset.hasNextPage = String(this.hasNextPage);\n\n\t\t/* refresh button */\n\t\tthis.updateButtonState();\n\n\t\t/* fire event for observers */\n\t\tthis.dispatchEvent(\n\t\t\tnew CustomEvent(\"onContentLoaded\", {\n\t\t\t\tbubbles: true,\n\t\t\t\tdetail: {\n\t\t\t\t\tdocument: parsedDoc,\n\t\t\t\t\titemsShown: this.itemsShown,\n\t\t\t\t\tcurrentPage: this.currentPage,\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n}\n\n/* register once */\nif (!customElements.get(\"load-content\")) {\n\tcustomElements.define(\"load-content\", LoadContent);\n}\n"],"names":["LoadContent","HTMLElement","constructor","super","this","currentPage","hasNextPage","baseUrl","mode","contentSelectors","appendFilter","itemsShown","isLoading","handleClick","bind","connectedCallback","readAttributes","addEventListener","updateButtonState","disconnectedCallback","removeEventListener","Number","dataset","url","window","location","pathname","targets","split","map","s","trim","filter","Boolean","reduce","sum","selector","el","document","querySelector","children","length","reset","opts","undefined","String","Array","isArray","join","dispatchEvent","CustomEvent","bubbles","detail","disable","setAttribute","enable","removeAttribute","setComplete","evt","preventDefault","fetchAndAppendNextPage","err","console","error","buildNextPageUrl","URL","origin","searchParams","set","href","response","fetch","credentials","ok","Error","status","html","text","parsedDoc","DOMParser","parseFromString","forEach","sourceEl","destinationEl","warn","elementMode","getAttribute","innerHTML","childrenToAppend","from","child","matches","appendChild","newLoadContentEl","customElements","get","define"],"mappings":"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"}